
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.14">
    
    
      
        <title>Synthetic Monitoring - Observability独習メモ</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a6bdf11c.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style>


    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans+JP+Light:300,300i,400,400i,700,700i%7CInconsolata:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"IBM Plex Sans JP Light";--md-code-font:"Inconsolata"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#synthetic-monitoring" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Observability独習メモ" class="md-header__button md-logo" aria-label="Observability独習メモ" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Observability独習メモ
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Synthetic Monitoring
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to Light mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to Light mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to Dark mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to Dark mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      はじめに
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../ansible01.md" class="md-tabs__link">
      Ansible101
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../robotshop/" class="md-tabs__link">
      robotshop
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Observability独習メモ" class="md-nav__button md-logo" aria-label="Observability独習メモ" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Observability独習メモ
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        はじめに
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ansible01.md" class="md-nav__link">
        Ansible101
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../robotshop/" class="md-nav__link">
        robotshop
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pop" class="md-nav__link">
    PoPサーバーの準備
  </a>
  
    <nav class="md-nav" aria-label="PoPサーバーの準備">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetesgke" class="md-nav__link">
    Kubernetesを準備する(今回はGKE)
  </a>
  
    <nav class="md-nav" aria-label="Kubernetesを準備する(今回はGKE)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-gcp" class="md-nav__link">
    1. gcpトライアルアカウントを用意
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-gcpcli" class="md-nav__link">
    2. gcpのcliをインストール
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cligke" class="md-nav__link">
    CLIでGKEをインストールする
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pophelm" class="md-nav__link">
    PoPをHelmインストール
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="synthetic-monitoring">Synthetic Monitoring</h1>
<p>外形監視を諸々試していくメモ。</p>
<h2 id="pop">PoPサーバーの準備</h2>
<p>外形監視は、InstanaBackend → PoPサーバー → 監視したいエンドポイントという流れで実施される。そのためPoPサーバーはInstanaとは別で用意する必要あり。</p>
<h3 id="kubernetesgke">Kubernetesを準備する(今回はGKE)</h3>
<p>悲しいことに、IBM Cloudの無償クラスターは2023年7月末で終了してしまったそうです。。。。<br />
自分のお金は仕事では使いたくないので、無償で使えるKubernetes環境を用意します。多分minikubeでも大丈夫ですが、GKEを用意していきます。</p>
<p>以下、手順<br />
1. gcpトライアルアカウントを用意
2. gcpのcliをインストール
3. CLIでGKEを構築していく</p>
<h4 id="1-gcp">1. gcpトライアルアカウントを用意</h4>
<p>これは各自実施してください。3ヶ月間、300ドル使いたい放題のため無料で遊べます。</p>
<h4 id="2-gcpcli">2. gcpのcliをインストール</h4>
<p>このあと必要になるやつも一緒にいれておく。
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>gcloud components install gke-gcloud-auth-plugin
</code></pre></div></p>
<h4 id="cligke">CLIでGKEをインストールする</h4>
<p>最初にProject_IDとRegionを環境変数にしておく。
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>export REGION=us-west1
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>export PROJECT_ID=&lt;ProjectID&gt;
</code></pre></div>
以下コマンドを実行するとGKEが作成される。container clusters create-auto</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>─ gcloud container clusters create-auto hello-cluster --region ${REGION} --project=${PROJECT_ID}
</code></pre></div>
<p>10分弱かかった。表示されたテキストにしたがい、gkeの認証をゲットする。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>gcloud container clusters get-credentials hello-cluster --region ${REGION}
</code></pre></div>
<p>get nodeで接続できたか確認する。
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>&gt; kubectl get node
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>NAME                                           STATUS   ROLES    AGE     VERSION
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>gk3-hello-cluster-default-pool-b8522c1c-dhfg   Ready    &lt;none&gt;   7m54s   v1.27.3-gke.100
</code></pre></div></p>
<h3 id="pophelm">PoPをHelmインストール</h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>この手順はあてでAnsible Playbookにする。</p>
</div>
<p>インストールするnamespaceを作成する。
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>kubectl create namespace instana-pop
</code></pre></div>
※ helmでnamespace作成もできる。</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>helm install synthetic-pop \
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    --repo &quot;https://agents.instana.io/helm&quot; \
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    --namespace instana-pop \
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    --set downloadKey=&quot;uBp4GXpZQpKrHxMXNcvInQ&quot; \
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    --set controller.location=&quot;CSM-Japan;CSM-Japan;Japan;Chiba;0;0;佐川のテスト用&quot; \
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    --set controller.clusterName=&quot;csm-sagawa-pop&quot; \
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    --set controller.instanaKey=&quot;uBp4GXpZQpKrHxMXNcvInQ&quot; \
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    --set controller.instanaSyntheticEndpoint=&quot;https://synthetics-orange-saas.instana.io&quot; \
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    --set redis.tls.enabled=false \
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    --set redis.password=&quot;ohgo0805&quot; \
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    synthetic-pop
</code></pre></div>
結果
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>NAME: synthetic-pop
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>LAST DEPLOYED: Thu Aug 24 17:11:51 2023
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>NAMESPACE: instana-pop
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>STATUS: deployed
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>REVISION: 1
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>TEST SUITE: None
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>NOTES:
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>CHART NAME: synthetic-pop
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>CHART VERSION: 1.0.15
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>APP VERSION: 1.256.0
</code></pre></div></p>
<p>いちおうkubectl get poする
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>❯ kubectl get pod -n instana-pop
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>NAME                                                           READY   STATUS    RESTARTS   AGE
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>synthetic-pop-browserscript-playback-engine-744fbdc6b6-d924d   1/1     Running   0          111s
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>synthetic-pop-controller-74ccbc7c-vx2gz                        0/1     Running   0          111s
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>synthetic-pop-http-playback-engine-9756dcd5d-2qldk             1/1     Running   0          111s
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>synthetic-pop-javascript-playback-engine-5bdf57bdd6-tckkl      1/1     Running   0          111s
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>synthetic-pop-redis-57c9bbd7db-qk9pj
</code></pre></div></p>
<p><img alt="成功！" src="../images/pod-deploy-success.png" /></p>
<h1 id="gkeagentinstall">GKEにAgentをInstallする</h1>
<p>外形監視として必要なわけではないが、せっかくなのでAgentもいれておく。Helmでcluster名とzoneを任意に設定。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>   helm install instana-agent \
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>   --repo https://agents.instana.io/helm \
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>   --namespace instana-agent \
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>   --create-namespace \
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>   --set agent.key=uBp4GXpZQpKrHxMXNcvInQ \
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>   --set agent.downloadKey=uBp4GXpZQpKrHxMXNcvInQ \
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>   --set agent.endpointHost=ingress-orange-saas.instana.io \
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>   --set agent.endpointPort=443 \
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>   --set cluster.name=&#39;csmj-3-gke-free&#39; \
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>   --set zone.name=&#39;csmj-3&#39; \
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>   instana-agent
</code></pre></div>
<p>すぐにsandboxから確認できた。
<img alt="instanaからGKE監視" src="../images/gke-ok.png" /></p>
<!-- TODO -->
<p>エラー。MasterNodeに何かしようとしたから？daemonsetはデプロイされてた。何か不具合がおこるかもしれないがあとで確認する
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>W0830<span class="w"> </span><span class="m">01</span>:57:18.364062<span class="w">   </span><span class="m">70659</span><span class="w"> </span>warnings.go:70<span class="o">]</span><span class="w"> </span>autopilot-default-resources-mutator:Autopilot<span class="w"> </span>updated<span class="w"> </span>DaemonSet<span class="w"> </span>instana-agent/instana-agent:<span class="w"> </span>adjusted<span class="w"> </span>resources<span class="w"> </span>to<span class="w"> </span>meet<span class="w"> </span>requirements<span class="w"> </span><span class="k">for</span><span class="w"> </span>containers<span class="w"> </span><span class="o">[</span>instana-agent<span class="o">]</span><span class="w"> </span><span class="o">(</span>see<span class="w"> </span>http://g.co/gke/autopilot-resources<span class="o">)</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>W0830<span class="w"> </span><span class="m">01</span>:57:18.513994<span class="w">   </span><span class="m">70659</span><span class="w"> </span>warnings.go:70<span class="o">]</span><span class="w"> </span>autopilot-default-resources-mutator:Autopilot<span class="w"> </span>updated<span class="w"> </span>Deployment<span class="w"> </span>instana-agent/k8sensor:<span class="w"> </span>adjusted<span class="w"> </span>resources<span class="w"> </span>to<span class="w"> </span>meet<span class="w"> </span>requirements<span class="w"> </span><span class="k">for</span><span class="w"> </span>containers<span class="w"> </span><span class="o">[</span>instana-agent<span class="o">]</span><span class="w"> </span><span class="o">(</span>see<span class="w"> </span>http://g.co/gke/autopilot-resources<span class="o">)</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>Error:<span class="w"> </span>INSTALLATION<span class="w"> </span>FAILED:<span class="w"> </span><span class="m">1</span><span class="w"> </span>error<span class="w"> </span>occurred:
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span>*<span class="w"> </span>admission<span class="w"> </span>webhook<span class="w"> </span><span class="s2">&quot;warden-validating.common-webhooks.networking.gke.io&quot;</span><span class="w"> </span>denied<span class="w"> </span>the<span class="w"> </span>request:<span class="w"> </span>GKE<span class="w"> </span>Warden<span class="w"> </span>rejected<span class="w"> </span>the<span class="w"> </span>request<span class="w"> </span>because<span class="w"> </span>it<span class="w"> </span>violates<span class="w"> </span>one<span class="w"> </span>or<span class="w"> </span>more<span class="w"> </span>constraints.
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>Violations<span class="w"> </span>details:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;[denied by autogke-disallow-hostnamespaces]&quot;</span>:<span class="o">[</span><span class="s2">&quot;enabling hostNetwork is not allowed in Autopilot.&quot;</span>,<span class="s2">&quot;enabling hostPID is not allowed in Autopilot.&quot;</span><span class="o">]</span>,<span class="s2">&quot;[denied by autogke-disallow-privilege]&quot;</span>:<span class="o">[</span><span class="s2">&quot;container instana-agent is privileged; not allowed in Autopilot&quot;</span><span class="o">]</span>,<span class="s2">&quot;[denied by autogke-no-host-port]&quot;</span>:<span class="o">[</span><span class="s2">&quot;container instana-agent specifies host ports [42699], which are disallowed in Autopilot.&quot;</span><span class="o">]</span>,<span class="s2">&quot;[denied by autogke-no-write-mode-hostpath]&quot;</span>:<span class="o">[</span><span class="s2">&quot;hostPath volume dev in container instana-agent is accessed in write mode; disallowed in Autopilot.&quot;</span>,<span class="s2">&quot;hostPath volume run in container instana-agent is accessed in write mode; disallowed in Autopilot.&quot;</span>,<span class="s2">&quot;hostPath volume var-run in container instana-agent is accessed in write mode; disallowed in Autopilot.&quot;</span>,<span class="s2">&quot;hostPath volume var-run-kubo in container instana-agent is accessed in write mode; disallowed in Autopilot.&quot;</span>,<span class="s2">&quot;hostPath volume var-run-containerd in container instana-agent is accessed in write mode; disallowed in Autopilot.&quot;</span>,<span class="s2">&quot;hostPath volume var-containerd-config in container instana-agent is accessed in write mode; disallowed in Autopilot.&quot;</span>,<span class="s2">&quot;hostPath volume sys in container instana-agent is accessed in write mode; disallowed in Autopilot.&quot;</span>,<span class="s2">&quot;hostPath volume var-log in container instana-agent is accessed in write mode; disallowed in Autopilot.&quot;</span>,<span class="s2">&quot;hostPath volume var-lib in container instana-agent is accessed in write mode; disallowed in Autopilot.&quot;</span>,<span class="s2">&quot;hostPath volume var-data in container instana-agent is accessed in write mode; disallowed in Autopilot.&quot;</span>,<span class="s2">&quot;hostPath volume machine-id in container instana-agent is accessed in write mode; disallowed in Autopilot.&quot;</span><span class="o">]}</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>Requested<span class="w"> </span>by<span class="w"> </span>user:<span class="w"> </span><span class="s1">&#39;chailatte915@gmail.com&#39;</span>,<span class="w"> </span>groups:<span class="w"> </span><span class="s1">&#39;system:authenticated&#39;</span>.
</code></pre></div></p>
<h2 id="try-browser-simple">Try Browser Simple</h2>
<ul>
<li>When to use?<br />
  シンプルテストは、HTTPエラー確認のため1つのウェブページをテストしたいときに使う。  </li>
<li>Tips  </li>
<li>作りたいテストの種類を選ぶ  </li>
<li>webページのurlを入力し、PoPのロケーションを選ぶ  </li>
<li>テスト頻度を選ぶ  </li>
</ul>
<p>これは簡単。webページにアクセスしたときに200で返ってくるかどうかを見るだけ。。表示が崩れてないか？一部のデータが取得できていなかったりしないか？をテストしたいときは、スクリプトテストを使う。</p>
<h2 id="try-script-test">Try Script Test</h2>
<p>Node.jsベースのスクリプトやSeleniumベースのAPIを使用して、Instanaでブラウザテストができる。予め定義されたグローバル変数やInstanaブラウザテスティングAPIを使用することで、ウェブブラウザ内でのユーザーの操作を模倣したブラウザスクリプトテストを作成し、実行できる。  </p>
<p>「これテストコード書けないと何もできないな...。」と思ったそこのあなた！！instanaはコードサンプルをたーくさん用意しています！</p>
<p><a href="https://github.com/instana/synthetic-browser-script/tree/main/examples">サンプルのテストコード</a></p>
<p>まずはサンプルの中にあった、IBMのホームページに対してテストを実行するコードを読み解いていきます</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">assert</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;chai&quot;</span><span class="p">);</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kd">let</span><span class="w"> </span><span class="nx">click</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">by</span><span class="p">,</span><span class="w"> </span><span class="nx">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">60000</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Click on </span><span class="si">${</span><span class="nx">message</span><span class="si">}</span><span class="sb"> &gt;&gt; </span><span class="si">${</span><span class="nx">by</span><span class="si">}</span><span class="sb"> &lt;&lt; `</span><span class="p">);</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">$browser</span><span class="p">.</span><span class="nx">waitForAndFindElement</span><span class="p">(</span><span class="nx">by</span><span class="p">,</span><span class="w"> </span><span class="nx">timeout</span><span class="p">);</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$browser</span><span class="p">.</span><span class="nx">actions</span><span class="p">().</span><span class="nx">move</span><span class="p">({</span><span class="w"> </span><span class="nx">origin</span><span class="o">:</span><span class="w"> </span><span class="nx">element</span><span class="w"> </span><span class="p">}).</span><span class="nx">press</span><span class="p">().</span><span class="nx">release</span><span class="p">().</span><span class="nx">perform</span><span class="p">();</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">out</span><span class="p">;</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`\ncatch(click): </span><span class="si">${</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">$browser</span><span class="p">.</span><span class="nx">takeScreenshot</span><span class="p">();</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="nx">err</span><span class="p">;</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="p">};</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="kd">let</span><span class="w"> </span><span class="nx">scrollToViewAndClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">by</span><span class="p">,</span><span class="w"> </span><span class="nx">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">60000</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">$browser</span><span class="p">.</span><span class="nx">waitForAndFindElement</span><span class="p">(</span><span class="nx">by</span><span class="p">,</span><span class="w"> </span><span class="nx">timeout</span><span class="p">);</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Scroll down to &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">)</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">$browser</span><span class="p">.</span><span class="nx">executeScript</span><span class="p">(</span><span class="s2">&quot;arguments[0].scrollIntoView()&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">element</span><span class="p">);</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Click &quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">);</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">$browser</span><span class="p">.</span><span class="nx">executeScript</span><span class="p">(</span><span class="s2">&quot;arguments[0].click();&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">element</span><span class="p">);</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`\ncatch(scrollToViewAndClick): </span><span class="si">${</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">$browser</span><span class="p">.</span><span class="nx">takeScreenshot</span><span class="p">();</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="nx">err</span><span class="p">;</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="p">}</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">$browser</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;https://www.ibm.com/us-en&quot;</span><span class="p">);</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Step1: Accept all cookies&quot;</span><span class="p">);</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">cookies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">$browser</span><span class="p">.</span><span class="nx">waitForAndFindElement</span><span class="p">(</span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="w">    </span><span class="nx">$driver</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">id</span><span class="p">(</span><span class="sb">`truste-consent-button`</span><span class="p">),</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a><span class="w">    </span><span class="mf">30000</span>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="w">  </span><span class="p">);</span>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">cookies</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Step2: Scroll down to developer education link and navigate to it&quot;</span><span class="p">);</span>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">scrollToViewAndClick</span><span class="p">(</span><span class="s1">&#39;developer link&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">$driver</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">linkText</span><span class="p">(</span><span class="sb">`Developer education`</span><span class="p">),</span><span class="w"> </span><span class="mf">30000</span><span class="p">);</span>
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Assert page title&quot;</span><span class="p">);</span>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">$browser</span><span class="p">.</span><span class="nx">waitForAndFindElement</span><span class="p">(</span><span class="nx">$driver</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="sb">`h1 &gt; strong`</span><span class="p">),</span><span class="w"> </span><span class="mf">30000</span><span class="p">);</span>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="w">  </span><span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="s2">&quot;Home - IBM Developer&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">$browser</span><span class="p">.</span><span class="nx">getTitle</span><span class="p">());</span>
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a>
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Step3: I want to learn Node.js&quot;</span><span class="p">);</span>
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">click</span><span class="p">(</span><span class="s2">&quot;programming tab&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">$driver</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="sb">`#tab-link-3-default`</span><span class="p">),</span><span class="w"> </span><span class="mf">10000</span><span class="p">);</span>
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">scrollToViewAndClick</span><span class="p">(</span><span class="s1">&#39;Get started with Node.js&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">$driver</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="sb">`#tab-panel-3-default &gt; div:nth-child(1) &gt; div:nth-child(2) &gt; div:nth-child(1) &gt; a:nth-child(1) &gt; div:nth-child(2)`</span><span class="p">),</span><span class="w"> </span><span class="mf">10000</span><span class="p">);</span>
<a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a>
<a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Step4: Move to Node.js summary&quot;</span><span class="p">);</span>
<a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">scrollToViewAndClick</span><span class="p">(</span><span class="s1">&#39;Summary&#39;</span><span class="p">,</span><span class="w">  </span><span class="nx">$driver</span><span class="p">.</span><span class="nx">By</span><span class="p">.</span><span class="nx">linkText</span><span class="p">(</span><span class="sb">`Summary`</span><span class="p">),</span><span class="w"> </span><span class="mf">10000</span><span class="p">)</span>
<a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a><span class="p">})();</span>
</code></pre></div>
<p>ee the following playback engines that support different Synthetic test types:</p>
<p>HTTP playback engine: Used to run the API Simple test (type: HTTPAction).
JavaScript playback engine: Used to run the API Script test (type: HTTPScript).
BrowserScript playback engine: Used to run the BrowserScript test (type: BrowserScript), Webpage Simple test (type: WebpageAction), and WebpageScript test (type: WebpageScript).
 Deployment Option
Synthetic PoP can be deployed only by the Helm charts.</p>
<p>The official Helm repository URL is https://agents.instana.io/helm, and the chart name is synthetic-pop.
The Helm chart Git repository URL is https://github.com/instana/synthetic-pop-charts.
 Prerequisites
Synthetic PoP needs to be deployed in a Kubernetes cluster. Use the helm chart to deploy Synthetic PoP, and ensure that Kubernetes and helm are installed in your environment.</p>
<p>Set up a Kubernetes cluster where the PoP will be installed. The minimum supported version for the kubernetes distribution is 1.10. For more information, see Set up Kubernetes.
Install Helm, and Helm V3 is recommended. For more information, see Installing Helm.
The minimum physical requirement to install the Synthetic PoP in the Kubernetes cluster is 3.1 core CPU and 2.7 GB memory.</p>
<p>Install
 Helm Install
Use the helm install command to install a new Synthetic PoP, and pass the following values. You are suggested to install the PoP in a separate namespace.</p>
<p>downloadKey: The download agent key for pulling image from containers.instana.io Docker registry.
controller.location: The format is label; displayLabel; country; city; latitude; longitude; description. This label acts as the PoP identifier and can only contain letter, number, hyphen and underscore.
controller.instanaKey: The Instana agent key, which is used for connecting to Instana backend.
controller.instanaSyntheticEndpoint: The ingress endpoint of synthetic acceptor in Instana backend.
controller.clusterName: Optionally. It needs to be set with the name of the Kubernetes cluster that is to be displayed in the Instana UI when Instana agent is installed to monitor this PoP.
redis.password: The authentication password to redis server. Specify a password with length at least 10.
redis.tls.enabled: Define if enabling Redis TLS or not (default false). If the value is true, the communication with Redis will be encrypted with TLS.
redis.tls.secretName: If the value of the redis.tls.enabled field is true, you need to specify a secret name for Redis TLS key/cert files.
Sign in to Instana UI, click Synthetic Monitoring, and then click Deploy a PoP. Copy the values of downloadKey, controller.instanaKey and controller.instanaSyntheticEndpoint.</p>
<p>To configure the installation, specify the values in the command line by using the --set flag, or provide a yaml file with your values by using the -f flag.</p>
<p>In the following example, a PoP is deployed, and Redis uses password for authentication.</p>
<p>helm install synthetic-pop \
    --repo https://agents.instana.io/helm  \
    --namespace syn \
    --create-namespace \
    --set downloadKey="yourdownloadkey" \
    --set controller.location="MyPoP;My PoP;China;Beijing;39.54;116.23;This is a testing Synthetic Point of Presence" \
    --set controller.instanaKey="instanaAgentkey" \
    --set controller.instanaSyntheticEndpoint="https://synthetics-green-saas.instana.io" \
    --set redis.tls.enabled=false \
    --set redis.password="a1fc5d01bcbb" \
    synthetic-pop</p>
<p>You can also provide your values.yaml to deploy a PoP, below examples shows how to get the values.yaml template and then pass the modified yaml file to deploy a PoP.</p>
<p>helm repo add synthetic-pop-repo https://agents.instana.io/helm
helm repo update
helm pull synthetic-pop-repo/synthetic-pop
tar xzvf synthetic-pop-*.tgz</p>
<h1 id="modify-the-synthetic-popvaluesyaml-file">Modify the synthetic-pop/values.yaml file</h1>
<h1 id="run-helm-install-to-pass-the-modified-valuesyaml">Run helm install to pass the modified values.yaml</h1>
<p>helm install synthetic-pop \
    --repo https://agents.instana.io/helm  \
    --namespace syn \
    --create-namespace \
    -f /path/to/values.yaml \
    synthetic-pop</p>
<p>After PoP is installed, make sure that each pod is in Running and Ready status.</p>
<p>kubectl get pod -n syn</p>
<p>Sign in to Instana UI, click Synthetic _Monitoring &gt; Locations, and then you can see your location is showed up in the location list. If not, go to the Troubleshooting section to check the log files.</p>
<p>Security Enhancement
The following configurations are recommended for security enhancement in production environment.</p>
<p>TLS encryption
PoP controller and different playback engines communicate through Redis server, and PoP controller provides an endpoint for health check. You can configure TLS to encrypt the communication through Redis TLS and encrypt the endpoint of PoP controller through HTTPS.</p>
<p>To configure TLS, you need to have your X.509 certificate-key pair (tls.crt, tls.key) and Certificate Authority (CA) root certificate file (ca.crt). If you do not have your key and certificate files, you can also use the openssl command to generate new ones. See the following examples:</p>
<p>openssl genrsa -out tls.key 4096
openssl req -x509 -new -nodes -sha256 -key tls.key -days 3650 -subj '/O=Instana/CN=Certificate Authority' -out ca.crt
openssl req -new -sha256 -key tls.key -subj '/O=Instana/CN=Server' | openssl x509 -req -sha256 -CA ca.crt -CAkey tls.key -CAserial ca.txt -CAcreateserial -days 3650 -out tls.crt</p>
<p>After key/cert files are provided, use the kubectl command to create a secret.</p>
<h1 id="create-a-new-tls-secret-named-pop-tls-secret-with-the-given-keycert-files">Create a new TLS secret named pop-tls-secret with the given key/cert files</h1>
<p>kubectl create secret generic pop-tls-secret -n syn \
--type='kubernetes.io/tls' \
--from-file=ca.crt=path/to/ca.crt \
--from-file=tls.crt=path/to/tls.crt \
--from-file=tls.key=path/to/tls.key</p>
<p>To deploy a PoP to support TLS, run the following command:</p>
<p>helm install synthetic-pop \
    --repo https://agents.instana.io/helm \
    --namespace syn \
    --create-namespace \
    --set downloadKey="yourdownloadkey" \
    --set controller.location="MyPoP;My PoP;China;Beijing;39.54;116.23;This is a testing Synthetic Point of Presence" \
    --set controller.instanaKey="instanaAgentkey" \
    --set controller.instanaSyntheticEndpoint="https://synthetics-green-saas.instana.io" \
    --set redis.tls.enabled=true \
    --set redis.tls.secretName="pop-tls-secret" \
    synthetic-pop</p>
<p>Secure Computing Mode
You can use secure computing mode (or seccomp) to sandbox the privileges of a process, which restricts the calls from user space into the kernel. Use the following parameter to enable RuntimeDefault as default seccomp profile for all containers.</p>
<p>Note: The default seccomp profile works only for Kubernetes version 1.19 or later or OCP (OpenShift Container Platform) version 4.11 or later. If seccompDefault is not set to true for OCP 4.11 or later, you can see some warning messages when you run the helm installation.</p>
<p>helm install synthetic-pop \
    --repo https://agents.instana.io/helm \
    --namespace syn \
   ...
    --set seccompDefault=true \
    synthetic-pop</p>
<p>Network Policy
By using the network policy, you can specify how a pod is allowed to communicate with the network. To block access from PoP to specific IPs or IP ranges, you can enable and customize the playbackEngineNetworkPolicy parameter. Typically, you can collect the following IP addresses:</p>
<p>Cloud provider metadata service IP address: It is 169.254.169.254 for AWS Metadata API, Google Cloud Metadata API, Azure Metadata API.
Kubernetes API server IP address: Use the kubectl command to collect Kubernetes API server IP address. See the following example for microk8s or minikube Kubernetes cluster:</p>
<h1 id="use-the-following-command-to-print-apiserver-endpoint">Use the following command to print apiserver endpoint</h1>
<h1 id="for-example-if-the-following-command-prints-endpoints-10128012716443-you-need-to-block-the-ip-address-101280127">For example, if the following command prints "Endpoints: 10.128.0.127:16443", you need to block the IP address 10.128.0.127</h1>
<p>kubectl describe service kubernetes</p>
<p>Then, modify the file values.yaml in helm charts as follows to enable Egress rules to block the IP addresses that you collect.</p>
<p>playbackEngineNetworkPolicy:
  # Change the value to true to enable the network policy
  enabled: true
  egress:
    - to:
        - ipBlock:
            # Allow all IP address v4
            cidr: 0.0.0.0/0
            except:
              # Block Kubernetes API server IP address
              - 10.128.0.127/32
              # Block cloud provider metadata service IP address
              - 169.254.169.254/32</p>
<p>See the following example to pass network policy by using --set:</p>
<h1 id="-set-json-only-be-supported-since-helm-v311">--set-json only be supported since Helm V3.11</h1>
<p>helm install synthetic-pop \
    --repo https://agents.instana.io/helm \
    --namespace syn \
   ...
    --set playbackEngineNetworkPolicy.enabled=true \
    --set-json 'playbackEngineNetworkPolicy.egress=[{"to":[{"ipBlock":{"cidr":"0.0.0.0/0","except":["10.128.0.127/32","169.254.169.254/32"]}}]}]' \
    synthetic-pop</p>
<p>Migration Scenario
To support the backend migration scenario, you can specify multiple synthetic acceptor endpoints and Instana agent keys with semicolon. Instana agent keys and synthetic acceptor endpoints are one-to-one correspondence. During the migration period, Synthetic PoP can send data to both old and new backend to avoid downtime.</p>
<p>See the following example:</p>
<p>helm install synthetic-pop \
    --repo https://agents.instana.io/helm \
    --namespace syn \
    --set controller.instanaKey="instanaAgentkey;anotherInstanaAgentKey" \
    --set controller.instanaSyntheticEndpoint="https://synthetics-green-saas.instana.io;https://synthetics-green-saas.instana.host" \
    ...</p>
<p>Upgrade
Use the helm upgrade command to update a Synthetic PoP. See the following example. You can change the parameters as needed.</p>
<p>helm upgrade synthetic-pop \
    --repo https://agents.instana.io/helm \
    --namespace syn \
    --set downloadKey="yourdownloadkey" \
    --set controller.location="MyPoP;My PoP;China;Beijing;39.54;116.23;This is a testing Synthetic Point of Presence" \
    --set controller.instanaKey="instanaAgentkey" \
    --set controller.instanaSyntheticEndpoint="https://synthetics-green-saas.instana.io" \
    --set redis.tls.enabled=false \
    --set redis.password="a1fc5d01bcbb" \
    synthetic-pop</p>
<p>Note:</p>
<p>The label value in the location parameter is an identifier of the PoP, and not allowed to change. You are recommended to change the displayLabel value as you want.
The redis password is not allowed to update. If you really need to change it, uninstall it and then reinstall it with updated redis password.
 Uninstall
Use the helm uninstall command to uninstall a Synthetic PoP.</p>
<p>helm uninstall synthetic-pop -n syn</p>
<p>Note: After the PoP is uninstalled, the PoP's location is still shown in the Instana UI with offline status. You can reinstall the PoP with the same location to make the location online again, or delete the location on UI if you do not use it anymore.</p>
<p>More Configuration Options
 Playback engine enablement
By default, three playback engines are enabled and deployed. You can disable some of them based on your requirement.
For example, if you do not need Browser tests, you can disable the BrowserScript playback engine by passing the following parameter to reduce the required CPU and memory resources for your Synthetic PoP.</p>
<p>--set browserscript.enabled=false</p>
<p>Scalability
Currently, only playback engines support horizontal scalability, and PoP Controller and Redis don't support horizontal scalability yet. The PoP workload is mainly on the playback engine pods. So to support more workload on a certain type of test, just increase the replicas number in the values.yaml file.</p>
<p>The following example shows that the replicas of JavaScript playback engine are increased to 2 and replicas of BrowserScript playback engine are increased to 3.</p>
<p>--set javascript.replicas=2
--set browserscript.replicas=3</p>
<p>Capabilities
The controller.capabilities property defines the playback capabilities for the Synthetic PoP, including the supported Synthetic test and web browser types.</p>
<p>CustomProperties
The controller.customProperties property defines the customized tags or properties for this PoP. The property is a list of key:value pairs, separated by a semicolon, such as key1=value1;key2=value2.</p>
<p>Use an API such as $env.key1 to access the custom property or tag in an API or browser script.</p>
<p>Proxy
You can configure a proxy server for synthetic PoP to connect the Instana backend server. The following options are supported.</p>
<p>proxy.popProxyProtocol: the protocol used by the proxy server. Set the value to http or socks.
proxy.popProxyServer: the proxy server address in the ipaddress:port format.
proxy.popProxyUserPass: the username and password to authenticate the proxy server. Enter the username and password in the username:password format.
Note: To configure the proxy server for Synthetic PoP to connect to the services that are being monitored, you can use the $network API to set a proxy server in the API script.</p>
<p>Using external secrets
If you don't want to use Helm chart to create new secrets for the keys controller.instanaKey, redis.password, proxy.popProxyUserPass, and downloadKey, you can use the existing secrets that you have created for the Synthetic PoP deployment by specifying the secret names as follows:</p>
<p>helm install synthetic-pop \
    --repo https://agents.instana.io/helm \
    --namespace syn \
    --set downloadSecret="my-pull-secret" \
    --set controller.instanaKeySecret="my-pop-secret" \
    --set redis.passwordSecret="my-pop-secret"  
    --set proxy.popProxyUserPassSecret="my-pop-secret" \
    ...</p>
<p>For the keys controller.instanaKey, redis.password, and proxy.popProxyUserPass, you can use the same secret or different existing secrets. However, when you create the secret, you must use the specified key fields instana-key, redis-password, and proxy-user-pass as follows:</p>
<p>kubectl create secret generic my-pop-secret  --namespace <namespace> \
 --from-literal=instana-key='<instana agent key>'  \
 --from-literal=redis-password='<redis password>'  \
 --from-literal=proxy-user-pass='<proxy username and password>'  </p>
<p>Note: You need to replace <namespace> with the namespace that you use to install the Synthetic PoP.</p>
<p>The secret for the downloadKey key must use the kubernetes.io/dockerconfigjson type. You can create the secret with the kubernetes.io/dockerconfigjson type as follows:</p>
<p>kubectl create secret docker-registry my-pull-secret --namespace <namespace> --docker-server="https://containers.instana.io" --docker-username="_" --docker-password="<downloadKey>" </p>
<p>Notes:</p>
<p>Replace <namespace> with the namespace that you use to install the Synthetic PoP.
Don't change the value of the --docker-username argument.
Replace <downloadKey> with the Instana download key.
 Monitoring
To monitor your Synthetic PoP, you are suggested to install the Instana host agent on the Kubernetes cluster where your PoP is installed.</p>
<p>Synthetic PoP sensor is automatically installed to monitor your PoP after the Instana host agent is installed. You can view the metrics in the Instana UI and get alerts if any health issue happens for your Synthetic PoP.</p>
<p>Performance
Check the default hardware requirements for running a Synthetic PoP:</p>
<p>CPU (vCPU/Core): 3.1 up to 5.6
Memory: 2700 Mi up to 4100 Mi
To check how many CPU and memory resources are allocated to each Pod of Synthetic PoP, check the requests and limits numbers in the resources sections for each Pod in the values.yaml file.</p>
<p>If you use the default CPU and memory resource allocation for a Synthetic PoP, then you can run 2000 API Simple tests, 20 API Scripts, and 5 BrowserScript tests in the performance benchmark testing with the following test configuration:</p>
<p>API simple test: Test frequency is 1 minute, and duration is around 200ms.
API script test: Test frequency is 1 minute, the script contains 5 HTTP calls, and the total duration is around 800ms.
BrowserScript test: Test frequency is 5 minutes, the script opens 2 web pages, and the total duration is around 20 seconds.
To support more workload, scale up as follows:</p>
<p>Vertical scaling: Increase the requests and limits numbers of CPU and memory. Because JavaScript playback engine is CPU-intensive, you can increase the requests and limits numbers of CPU to support more API script tests. For example, if the requests and limits numbers of CPU are set to 800m and 1000m (0.8/1.0 Core), 40 API scripts can be supported with the previously described test configuration.
Horizontal scaling: A simpler approach is provided to increase the replica number of different playback engines. For more information, see the Scalability section.
 Troubleshooting
To check the Helm chart version, run the following command:</p>
<p>helm list -n <namespace></p>
<p>You can get the version number from the result such as synthetic-pop-<version>.</p>
<p>If you meet any issues, for example, the location that you specify can't be shown on Instana Synthetic UI, first check the PoP controller log by running the following command:</p>
<p>kubectl logs -n <namespace> -f <pop_controller_pod_name></p>
<p>To change the trace level of each component, you can pass the traceLevel values as follows to make an upgrade on your PoP:</p>
<p>--set controller.traceLevel="DEBUG"
--set http.traceLevel="DEBUG"
--set javascript.traceLevel="DEBUG"
--set browserscript.traceLevel="DEBUG"</p>
<p>You can also dynamically change the trace level of PoP controller without restarting the pod by running the set_trace_level.sh command in the container.</p>
<h1 id="enter-synthetic-pop-controller-container">enter synthetic-pop-controller container</h1>
<p>kubectl exec -it -n <namespace> <pop_controller_pod_name> -- bash</p>
<h1 id="run-set_trace_levelsh-command-to-change-trace-level-to-debug">run set_trace_level.sh command to change trace level to DEBUG</h1>
<p>./set_trace_level.sh DEBUG</p>
<p>A pdcollect.sh script is provided to collect and package log files of Synthetic PoP into a tar.gz file and send it to Instana support team for assistance. You can find the pdcollect.sh script in the Instana Helm charts directory or download it from the synthetic-pop-charts repository. Run the following command:</p>
<h2 id="collect-pop-logs-from-a-namespace">collect PoP logs from a namespace</h2>
<p>./pdcollect.sh -n <namespace></p>
<h2 id="instana-agent-on-iks">Instana Agent on IKS</h2>
<p>手順
1. namespaceを作成する
   <div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>kubectl create namespace instana-
</code></pre></div>
2. Instanaのダッシュボードから各種接続情報を確認する
   1. Agent Deploy &gt; Kubernetes &gt; Helm
3. Helm Installでエージェントをデプロイする
   <div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>helm install instana-agent --namespace instana-agent \
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a> --repo https://agents.instana.io/helm \
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a> --set agent.key=&#39;&lt;your agent key - as described above&gt;&#39; \
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a> --set agent.endpointHost=&#39;&lt;your host agent endpoint - as described above&gt;&#39; \
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a> --set cluster.name=&#39;&lt;your-cluster-name&gt;&#39; \
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a> --set zone.name=&#39;&lt;your-cluster-name&gt;&#39; \
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a> instana-agent
</code></pre></div></p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2023 <a href="https://github.com/junkisagawa"  target="_blank" rel="noopener">Junki Sagawa</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>